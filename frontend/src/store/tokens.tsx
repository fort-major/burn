import { Accessor, createContext, createEffect, createSignal, on, useContext } from "solid-js";
import { Fetcher, IChildren } from "../utils/types";
import { ErrorCode, err, logErr, logInfo } from "../utils/error";
import { createStore, Store } from "solid-js/store";
import { useAuth } from "./auth";
import { Principal } from "@dfinity/principal";
import { E8s, EDs } from "@utils/math";
import { bytesToHex, debugStringify, tokensToStr } from "@utils/encoding";
import { IcrcLedgerCanister, IcrcMetadataResponseEntries } from "@dfinity/ledger-icrc";
import { newBurnerActor, newICPSwapInfoActor, opt, optUnwrap } from "@utils/backend";
import { nowNs } from "@utils/common";

export type TPrincipalStr = string;
export type TSubaccountStr = string;
export type TSubaccount = Uint8Array;
export type TTicker = string;

export interface ITokenMetadata {
  id: Principal;
  fee: EDs;
  ticker: TTicker;
  logoSrc: string;
  name: string;
}

export interface ITokensStoreContext {
  balances: Store<
    Partial<Record<TPrincipalStr, Partial<Record<TPrincipalStr, Partial<Record<TSubaccountStr, bigint>>>>>>
  >;
  balanceOf: (tokenId: Principal, owner: Principal, subaccount?: TSubaccount) => bigint | undefined;
  fetchBalanceOf: (tokenId: Principal, owner: Principal, subaccount?: TSubaccount) => Promise<void>;

  subaccounts: Store<Partial<Record<TPrincipalStr, Uint8Array>>>;
  fetchSubaccountOf: (id: Principal) => Promise<void>;

  metadata: Store<Partial<Record<TPrincipalStr, ITokenMetadata>>>;
  fetchMetadata: (id: Principal) => Promise<void>;

  icpSwapUsdExchangeRates: Store<Partial<Record<TPrincipalStr, E8s>>>;
  fetchIcpSwapUsdExchangeRates: () => Promise<void>;

  totalBurnSupply: Accessor<E8s | undefined>;
  fetchTotalBurnSupply: Fetcher;
}

const TokensContext = createContext<ITokensStoreContext>();

export function useTokens(): ITokensStoreContext {
  const ctx = useContext(TokensContext);

  if (!ctx) {
    err(ErrorCode.UNREACHEABLE, "Tokens context is not initialized");
  }

  return ctx;
}

export const DEFAULT_TOKENS = {
  burn: Principal.fromText(import.meta.env.VITE_BURN_TOKEN_CANISTER_ID),
  icp: Principal.fromText("ryjl3-tyaaa-aaaaa-aaaba-cai"),
};

export function TokensStore(props: IChildren) {
  const { assertReadyToFetch, anonymousAgent, isAuthorized, identity } = useAuth();

  const [balances, setBalances] = createStore<ITokensStoreContext["balances"]>();
  const [subaccounts, setSubaccounts] = createStore<ITokensStoreContext["subaccounts"]>();
  const [metadata, setMetadata] = createStore<ITokensStoreContext["metadata"]>();
  const [icpSwapUsdExchangeRates, setIcpSwapUsdExchangeRates] =
    createStore<ITokensStoreContext["icpSwapUsdExchangeRates"]>();
  const [totalBurnSupply, setTotalBurnSupply] = createSignal<E8s>();

  createEffect(
    on(anonymousAgent, (a) => {
      if (!a) return;

      fetchTotalBurnSupply();

      if (Object.keys(icpSwapUsdExchangeRates).length === 0) {
        fetchIcpSwapUsdExchangeRates();
      }
    })
  );

  const fetchTotalBurnSupply: ITokensStoreContext["fetchTotalBurnSupply"] = async () => {
    assertReadyToFetch();

    const burnToken = IcrcLedgerCanister.create({ canisterId: DEFAULT_TOKENS.burn, agent: anonymousAgent()! });
    const totalSupply = await burnToken.totalTokensSupply({});

    setTotalBurnSupply(E8s.new(totalSupply));
  };

  const fetchIcpSwapUsdExchangeRates: ITokensStoreContext["fetchIcpSwapUsdExchangeRates"] = async () => {
    const actor = await newICPSwapInfoActor();
    const entries = await actor.getAllTokens();

    for (let entry of entries) {
      const rate = E8s.fromFloat(entry.priceUSD);

      setIcpSwapUsdExchangeRates(entry.address, rate);
    }
  };

  const balanceOf: ITokensStoreContext["balanceOf"] = (tokenId, owner, subaccount) => {
    return balances[tokenId.toText()]?.[owner.toText()]?.[bytesToHex(orDefaultSubaccount(subaccount))];
  };

  const fetchBalanceOf: ITokensStoreContext["fetchBalanceOf"] = async (tokenId, owner, subaccount) => {
    assertReadyToFetch();

    const ledger = IcrcLedgerCanister.create({ agent: anonymousAgent()!, canisterId: tokenId });
    const balance = await ledger.balance({ owner: owner, subaccount });

    const tId = tokenId.toText();
    const oId = owner.toText();
    const sub = bytesToHex(orDefaultSubaccount(subaccount));

    if (!balances[tId]) {
      setBalances(tId, {});
    }

    if (!balances[tId]?.[oId]) {
      setBalances(tId, oId, {});
    }

    setBalances(tId, oId, sub, balance);
  };

  const fetchSubaccountOf: ITokensStoreContext["fetchSubaccountOf"] = async (id) => {
    assertReadyToFetch();

    const burner = newBurnerActor(anonymousAgent()!);
    const subaccount = await burner.subaccount_of(id);

    setSubaccounts(id.toText(), subaccount as Uint8Array);
  };

  const fetchMetadata: ITokensStoreContext["fetchMetadata"] = async (id) => {
    assertReadyToFetch();

    const cached = getCachedMetadata(id);
    if (cached) {
      setMetadata(id.toText(), cached);
      return;
    }

    const ledger = IcrcLedgerCanister.create({ agent: anonymousAgent()!, canisterId: id });
    const metadata = await ledger.metadata({ certified: false });

    const name = (metadata.find((it) => it[0] === IcrcMetadataResponseEntries.NAME)![1] as { Text: string }).Text;
    const symbol = (metadata.find((it) => it[0] === IcrcMetadataResponseEntries.SYMBOL)![1] as { Text: string }).Text;
    const fee = (metadata.find((it) => it[0] === IcrcMetadataResponseEntries.FEE)![1] as { Nat: bigint }).Nat;
    const decimals = (metadata.find((it) => it[0] === IcrcMetadataResponseEntries.DECIMALS)![1] as { Nat: bigint }).Nat;

    let logoEntry = metadata.find((it) => it[0] === IcrcMetadataResponseEntries.LOGO);
    let logo: string | undefined = undefined;

    if (logoEntry) {
      logo = (logoEntry![1] as { Text: string }).Text;
    }

    if (!logo && id.compareTo(DEFAULT_TOKENS.icp) === "eq") {
      logo =
        "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIHZpZXdCb3g9IjAgMCA1MCA1MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGcgY2xpcC1wYXRoPSJ1cmwoI2NsaXAwXzgwM18yNTUxKSI+CjxwYXRoIGQ9Ik01MCAyNUM1MCAzOC44MDcgMzguODA3IDUwIDI1IDUwQzExLjE5MjkgNTAgMCAzOC44MDcgMCAyNUMwIDExLjE5MjkgMTEuMTkyOSAwIDI1IDBDMzguODA3IDAgNTAgMTEuMTkyOSA1MCAyNVoiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik0zNC45NDI2IDI5LjYxNjdDMzIuODM0MiAyOS42MTY3IDMwLjYwODIgMjguMjM4MSAyOS41MTU3IDI3LjIzODNDMjguMzIwNyAyNi4xNDQ0IDI1LjAzOCAyMi41ODM4IDI1LjAyMzYgMjIuNTY3N0MyMi44NzA5IDIwLjE2NiAxOS45NzY1IDE3LjUgMTcuMDg5IDE3LjVDMTMuNjExMyAxNy41IDEwLjU3NzkgMTkuOTA4NiA5Ljc4OTA2IDIzLjA5OTJDOS44NDkyNyAyMi44ODg4IDEwLjk1NSAxOS45NjYxIDE1LjEwNTIgMTkuOTY2MUMxNy4yMTM2IDE5Ljk2NjEgMTkuNDM5NiAyMS4zNDQ0IDIwLjUzMjEgMjIuMzQ0NEMyMS43MjcxIDIzLjQzODEgMjUuMDA5NiAyNi45OTkgMjUuMDI0MiAyNy4wMTQ4QzI3LjE3NjcgMjkuNDE2NyAzMC4wNzEzIDMyLjA4MjcgMzIuOTU5NCAzMi4wODI3QzM2LjQzNzEgMzIuMDgyNyAzOS40Njk5IDI5LjY3NCA0MC4yNTk0IDI2LjQ4MzVDNDAuMTk5MiAyNi42OTM4IDM5LjA5MjggMjkuNjE2NyAzNC45NDI2IDI5LjYxNjdaIiBmaWxsPSIjMjlBQUUxIi8+CjxwYXRoIGQ9Ik0yNS4wMjI3IDI3LjAxNTZDMjUuMDE1MiAyNy4wMDY2IDI0LjA2OTkgMjUuOTgxOSAyMy4wMDk3IDI0Ljg2MzVDMjIuNDM2OCAyNS41NDM3IDIxLjYxMTQgMjYuNDcwNCAyMC42NjI4IDI3LjMwMTJDMTguODk0MiAyOC44NTEyIDE3Ljc0NDggMjkuMTc2NCAxNy4wODc1IDI5LjE3NjRDMTQuNjA3NiAyOS4xNzY0IDEyLjU4NDQgMjcuMjA5NCAxMi41ODQ0IDI0Ljc5MTZDMTIuNTg0NCAyMi4zNzM5IDE0LjYwNDggMjAuNDIyIDE3LjA4NzUgMjAuNDA2OEMxNy4xNzc0IDIwLjQwNjggMTcuMjg2OCAyMC40MTU4IDE3LjQxODMgMjAuNDM5NEMxNi42NzI0IDIwLjE1MjkgMTUuODgwMSAxOS45NjYxIDE1LjEwMzcgMTkuOTY2MUMxMC45NTQ4IDE5Ljk2NjEgOS44NDk0MyAyMi44ODc1IDkuNzg4NTMgMjMuMDk5MUM5LjY1NDMgMjMuNjQzMSA5LjU4MjAzIDI0LjIwOTEgOS41ODIwMyAyNC43OTE2QzkuNTgyMDMgMjguODEyNSAxMi44OTg1IDMyLjA4MzMgMTcuMDM0MiAzMi4wODMzQzE4Ljc1ODUgMzIuMDgzMyAyMC42ODk3IDMxLjE5OTggMjIuNjc4NSAyOS40NTZDMjMuNjE4NyAyOC42MzE5IDI0LjQzMzkgMjcuNzUwNCAyNS4wNDYyIDI3LjA0MTlDMjUuMDM4NyAyNy4wMzI5IDI1LjAzMDQgMjcuMDI0NiAyNS4wMjI3IDI3LjAxNTZaIiBmaWxsPSJ1cmwoI3BhaW50MF9saW5lYXJfODAzXzI1NTEpIi8+CjxwYXRoIGQ9Ik0yNS4wMjQgMjIuNTY3N0MyNS4wMzE1IDIyLjU3NjcgMjUuOTc2NSAyMy42MDE1IDI3LjAzNjUgMjQuNzE5OEMyNy42MDk0IDI0LjAzOTYgMjguNDM0OCAyMy4xMTI5IDI5LjM4MzUgMjIuMjgyMUMzMS4xNTIxIDIwLjczMjEgMzIuMzAxNSAyMC40MDY4IDMyLjk1ODcgMjAuNDA2OEMzNS40Mzg3IDIwLjQwNjggMzcuNDYxOSAyMi4zNzQgMzcuNDYxOSAyNC43OTE3QzM3LjQ2MTkgMjcuMTk1NCAzNS40NDE1IDI5LjE2MTIgMzIuOTU4NyAyOS4xNzY1QzMyLjg2ODcgMjkuMTc2NSAzMi43NTk2IDI5LjE2NzUgMzIuNjI3OSAyOS4xNDRDMzMuMzc0IDI5LjQzMDQgMzQuMTY2MiAyOS42MTczIDM0Ljk0MjUgMjkuNjE3M0MzOS4wOTIxIDI5LjYxNzMgNDAuMTk3OSAyNi42OTU4IDQwLjI1ODcgMjYuNDg0MkM0MC4zOTI5IDI1Ljk0MDIgNDAuNDY1IDI1LjM3NDQgNDAuNDY1IDI0Ljc5MTdDNDAuNDY1IDIwLjc3MDggMzcuMDk0NiAxNy41IDMyLjk1ODcgMTcuNUMzMS4yMzQ0IDE3LjUgMjkuMzU3MyAxOC4zODM2IDI3LjM2NzkgMjAuMTI3M0MyNi40Mjc1IDIwLjk1MTUgMjUuNjEyNSAyMS44MzI5IDI1IDIyLjU0MTVDMjUuMDA3NyAyMi41NTA0IDI1LjAxNjIgMjIuNTU4OCAyNS4wMjQgMjIuNTY3N1oiIGZpbGw9InVybCgjcGFpbnQxX2xpbmVhcl84MDNfMjU1MSkiLz4KPC9nPgo8ZGVmcz4KPGxpbmVhckdyYWRpZW50IGlkPSJwYWludDBfbGluZWFyXzgwM18yNTUxIiB4MT0iMzQuODczMyIgeTE9IjQyLjU1MjMiIHgyPSIwLjY3NzQ5OSIgeTI9IjE0LjgwNDYiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIj4KPHN0b3Agb2Zmc2V0PSIwLjIyIiBzdG9wLWNvbG9yPSIjRUMxRTc5Ii8+CjxzdG9wIG9mZnNldD0iMC44OSIgc3RvcC1jb2xvcj0iIzUyMjc4NCIvPgo8L2xpbmVhckdyYWRpZW50Pgo8bGluZWFyR3JhZGllbnQgaWQ9InBhaW50MV9saW5lYXJfODAzXzI1NTEiIHgxPSIyOS4wNjEiIHkxPSIxOC40NjA0IiB4Mj0iMzkuMjE3MyIgeTI9IjI4Ljk3NzkiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIj4KPHN0b3Agb2Zmc2V0PSIwLjIxIiBzdG9wLWNvbG9yPSIjRjA1QTI0Ii8+CjxzdG9wIG9mZnNldD0iMC42OCIgc3RvcC1jb2xvcj0iI0ZBQUYzQiIvPgo8L2xpbmVhckdyYWRpZW50Pgo8Y2xpcFBhdGggaWQ9ImNsaXAwXzgwM18yNTUxIj4KPHJlY3Qgd2lkdGg9IjUwIiBoZWlnaHQ9IjUwIiBmaWxsPSJ3aGl0ZSIvPgo8L2NsaXBQYXRoPgo8L2RlZnM+Cjwvc3ZnPgo=";
    }

    if (!logo && id.toText() === "4c4fd-caaaa-aaaaq-aaa3a-cai") {
      logo =
        "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABkAAAAZACAIAAACubhnwAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA3VpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQ4IDc5LjE2NDAzNiwgMjAxOS8wOC8xMy0wMTowNjo1NyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpkYTg0YjcxMC1iNjgwLTQxMmQtOTVmMC0xN2IwYTQ5ODEzOTYiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QzBERDM3QzVENUM0MTFFQzgyRTk4RjZFQUEyMENDNzQiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QzBERDM3QzRENUM0MTFFQzgyRTk4RjZFQUEyMENDNzQiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIxLjAgKE1hY2ludG9zaCkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDoyNDBmYWIwMC00ZTJjLTRkYTktYjRmZS1lNDc3M2Q4NzNiNjUiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6ZGE4NGI3MTAtYjY4MC00MTJkLTk1ZjAtMTdiMGE0OTgxMzk2Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+Yl+BXwAALS9JREFUeNrs2rFx1FAUQFHMaDvYLjbwbA+e3W6og4CAhIw2CKQmFKkLdaCEwKkTBgyXv+d08N7T2Dt3/tPzl5cPAAAAAFD10QoAAAAAKBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABI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AGkCFgAAAABpAhYAAAAAaQIWAAAAAGkCFgAAAABpAhYAAAAAaQIWAAAAAGkCFgAAAABpAhYAAAAAaQIWAAAAAGkCFgAAAABpAhYAAAAAaQIWAAAAAGkCFgAAAABpAhYAAAAAaQIWAAAAAGkCFgAAAABpAhYAAAAAaQIWAAAAAGkCFgAAAABpAhYAAAAAaQIWAAAAAGkCFgAAAABpAhYAAAAAaQIWAAAAAGkCFgAAAABpAhYAAAAAaQIWAAAAAGkCFgAAAABpAhYAAAAAaQIWAAAAAGkCFgAAAABpAhYAAAAAaQIWAAAAAGkCFgAAAABpAhYAAAAAaQIWAAAAAGkCFgAAAABpAhYAAAAAaQIWAAAAAGkCFgAAAABpAhYAAAAAaQIWAAAAAGkCFgAAAABpAhYAAAAAaQIWAAAAAGkCFgAAAABpAhYAAAAAaQIWAAAAAGkCFgAAAABpAhYAAAAAaQIWAAAAAGkCFgAAAABpAhYAAAAAaQIWAAAAAGkCFgAAAABpAhYAAAAAaQIWAAAAAGkCFgAAAABpkxUAAPCwTvfzqKMd8+5qrgYwDC+wAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASBOwAAAAAEgTsAAAAABIE7AAAAAASJusAN7DtqyjjnbMu/sCAOA35KvT/TzqaJfb1adLhxdYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApE1WwD+0Leuoox3z7r4Aj+bbj++WAPgzAvAevMACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgbbICAAAe1tdPny3B1QDo8wILAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACAtKfnLy+2AH/ctqyjjnbMu/sCAMCr0/086miX29V96fACCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBC+Anu3ZsVCEQBVA0gQ7ogogmoGZswsgu6IDEwAocdf5lPaeD92CG5c4CAACQJmABAAAAkCZgAQAAAJAmYAEAAACQJmABAAAAkCZgAQAAAJAmYAEAAACQJmABAAAAkCZgAQAAAJAmYAEAAACQJmABAAAAkCZgAQAAAJAmYAEAAACQJmABAAAAkCZgAQAAAJAmYAEAAACQJmABAAAAkCZgAQAAAJAmYAEAAACQJmABAAAAkCZgAQAAAJAmYAEAAACQJmABAAAAkCZgAQAAAJAmYAEAAACQJmABAAAAkCZgAQAAAJAmYAEAAACQJmABAAAAkCZgAQAAAJAmYAEAAACQJmABAAAAkCZgAQAAAJAmYAEAAACQJmABAAAAkCZgAQAAAJAmYAEAAACQJmABAAAAkCZgAQAAAJAmYAEAAACQJmABAAAAkCZgAQAAAJAmYAEAAACQJmABAAAAkCZgAQAAAJAmYAEAAACQJmABAAAAkCZgAQAAAJAmYAEAAACQJmABAAAAkCZgAQAAAJA2WQEv9PH2Pupo93l5vgAAAPAr3MACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIE3AAgAAACBNwAIAAAAgTcACAAAAIG2yAl5o3bdRR5uPZdTR7vPy6gIA4Hg8/E8NpLiBBQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQNpkBfAX1n0bdbT5WEYd7T4vry4A4KDleAwEuYEFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABA2mQFwLes+zbqaPOxeL6Pc5+XJQD8NwN/sgc+aAH8kBtYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApAlYAAAAAKQJWAAAAACkCVgAAAAApE1WAPBl3TdLeJz5WCwBwCcbgOG5gQUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAECagAUAAABAmoAFAAAAQJqABQAAAEDaZAUAPNe6b5YAAADDcwMLAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIA0AQsAAACANAELAAAAgDQBCwAAAIC0TwEGAG3/Xn8LH65PAAAAAElFTkSuQmCC";
    }

    if (!logo && id.toText() === "2ouva-viaaa-aaaaq-aaamq-cai") {
      logo =
        "data:image/png;base64,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";
    }

    const meta: ITokenMetadata = {
      name,
      ticker: symbol,
      fee: EDs.new(fee, Number(decimals)),
      id,
      logoSrc: logo!,
    };

    cacheMetadata(meta);
    setMetadata(id.toText(), meta);
  };

  return (
    <TokensContext.Provider
      value={{
        balances,
        balanceOf,
        fetchBalanceOf,
        subaccounts,
        fetchSubaccountOf,
        metadata,
        fetchMetadata,
        icpSwapUsdExchangeRates,
        fetchIcpSwapUsdExchangeRates,

        totalBurnSupply,
        fetchTotalBurnSupply,
      }}
    >
      {props.children}
    </TokensContext.Provider>
  );
}

function orDefaultSubaccount(subaccount?: TSubaccount): TSubaccount {
  return subaccount ? subaccount : new Uint8Array(32);
}

interface ICachedMetadata {
  timestamp: number;
  name: string;
  ticker: string;
  fee: string;
  decimals: number;
  id: string;
  logoSrc: string;
}

function cacheMetadata(m: ITokenMetadata) {
  const meta: ICachedMetadata = {
    timestamp: Date.now(),
    name: m.name,
    ticker: m.ticker,
    fee: m.fee.val.toString(),
    decimals: m.fee.decimals,
    id: m.id.toText(),
    logoSrc: m.logoSrc,
  };

  localStorage.setItem(`msq-burn-token-metadata-${meta.id}`, JSON.stringify(meta));
}

const ONE_WEEK_MS = 1000 * 60 * 60 * 24 * 7;

function getCachedMetadata(id: Principal): ITokenMetadata | undefined {
  const metaOpt = localStorage.getItem(`msq-burn-token-metadata-${id.toText()}`);
  if (!metaOpt) return undefined;

  const meta: ICachedMetadata = JSON.parse(metaOpt);
  const now = Date.now();

  if (meta.timestamp + ONE_WEEK_MS < now) return undefined;

  return {
    name: meta.name,
    ticker: meta.ticker,
    fee: EDs.new(BigInt(meta.fee), meta.decimals),
    id: Principal.fromText(meta.id),
    logoSrc: meta.logoSrc,
  };
}
